<div class="max-w-[800px] mx-auto p-4">
  <!-- Cart Header -->
  <div class="flex justify-between items-center mb-6 pb-4 border-b border-surface-border">
    <div class="flex items-center gap-2">
      <h2 class="text-2xl font-semibold m-0">Your Cart</h2>
      @if (itemCount() > 0) {
        <p-badge [value]="itemCount()" severity="info"></p-badge>
      }
    </div>

    @if (!isEmpty()) {
      <p-button
        label="Clear Cart"
        icon="pi pi-trash"
        severity="danger"
        [outlined]="true"
        size="small"
        (onClick)="confirmClearCart()"
        [disabled]="isLoading()">
      </p-button>
    }
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="my-8">
      <p-skeleton height="80px" styleClass="mb-3"></p-skeleton>
      <p-skeleton height="80px" styleClass="mb-3"></p-skeleton>
      <p-skeleton height="80px" styleClass="mb-3"></p-skeleton>
    </div>
  }

  <!-- Empty Cart State -->
  @if (isEmpty() && !isLoading()) {
    <div class="flex items-center justify-center p-12 min-h-[300px] text-center">
      <div class="max-w-[400px]">
        <i class="pi pi-shopping-cart text-6xl text-color-secondary opacity-70 mb-6"></i>
        <h3 class="m-0 mb-4 text-xl font-semibold text-color">Your cart is empty</h3>
        <p class="m-0 mb-8 text-color-secondary leading-relaxed">
          Browse our menu and add some delicious items to get started!
        </p>
        <p-button label="Browse Menu" icon="pi pi-search" (onClick)="navigateToMenu()"></p-button>
      </div>
    </div>
  }

  <!-- Cart Content -->
  @if (!isEmpty() && !isLoading()) {
    <div class="flex flex-col gap-6">
      <!-- Cart Items -->
      <div>
        <p-card styleClass="mb-4">
          <ng-template pTemplate="header">
            <div class="flex items-center justify-between p-3">
              <h3 class="m-0">Items ({{ itemCount() }})</h3>
              <span class="text-sm text-color-secondary">
                Last updated: {{ lastUpdated() | date:'short' }}
              </span>
            </div>
          </ng-template>
          <p-scrollPanel [style]="{ width: '100%', height: '400px' }">
            <div class="flex flex-col gap-4">
              @for (item of items(); track trackByItemId($index, item)) {
                <tabletap-cart-item
                  [item]="item"
                  [disabled]="isLoading()"
                  (quantityChange)="onQuantityChange($event)"
                  (customizationChange)="onCustomizationChange($event)"
                  (notesChange)="onNotesChange($event)"
                  (remove)="confirmRemoveItem($event)"
                  class="border-b border-surface-border pb-4 last:border-b-0 last:pb-0 transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg">
                </tabletap-cart-item>
              }
            </div>
          </p-scrollPanel>
        </p-card>
      </div>
      <p-divider></p-divider>
      <!-- Order Summary -->
      <div>
        <tabletap-order-summary
          [cart]="cart()"
          [isCheckoutEnabled]="isValidForCheckout()"
          [errors]="errors()"
          (checkout)="onCheckout()"
          (applyDiscount)="onApplyDiscount($event)">
        </tabletap-order-summary>
      </div>
    </div>
  }

  <!-- Error Messages -->
  @if (errors().length > 0) {
    <div class="mt-3">
      <p-card severity="danger">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-3">
            <i class="pi pi-exclamation-triangle text-red-500"></i>
            <span class="font-semibold text-red-500">Cart Issues</span>
          </div>
        </ng-template>
        <ul class="list-none p-0 m-0">
          @for (error of errors(); track error) {
            <li class="mb-2">
              <i class="pi pi-times text-red-500 mr-2"></i>
              {{ formatError(error) }}
            </li>
          }
        </ul>
      </p-card>
    </div>
  }
</div>

<!-- Toast Messages -->
<p-toast position="top-right"></p-toast>

<!-- Confirmation Dialogs -->
<p-confirmDialog></p-confirmDialog>
