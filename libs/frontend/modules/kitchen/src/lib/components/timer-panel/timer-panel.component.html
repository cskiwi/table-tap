<p-card class="timer-panel">
  <ng-template pTemplate="header">
    <div class="flex items-center justify-between p-4">
      <div class="flex items-center gap-2">
        <i class="pi pi-clock text-xl"></i>
        <span class="font-semibold">Active Timers</span>
        @if (activeTimers().length > 0) {
          <p-badge [value]="activeTimers().length.toString()"></p-badge>
        }
      </div>
      <p-button
        icon="pi pi-times"
        severity="secondary"
        [text]="true"
        (click)="close.emit()">
      </p-button>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <!-- Summary Stats -->
    @if (activeTimers().length > 0) {
      <div class="flex justify-around mb-4 p-3 bg-surface-50 dark:bg-surface-800 rounded-lg">
        <div class="flex items-center gap-2">
          <i class="pi pi-play-circle text-green-500"></i>
          <span>{{ runningTimers().length }} Running</span>
        </div>
        <div class="flex items-center gap-2">
          <i class="pi pi-exclamation-circle text-red-500"></i>
          <span>{{ expiredTimers().length }} Expired</span>
        </div>
        <div class="flex items-center gap-2">
          <i class="pi pi-pause-circle text-yellow-500"></i>
          <span>{{ pausedTimers().length }} Paused</span>
        </div>
      </div>
    }

    @if (activeTimers().length > 0) {
      <p-divider></p-divider>
    }

    <!-- Timer List -->
    @if (activeTimers().length > 0) {
      <div class="flex flex-col gap-3">
        @for (timer of sortedTimers(); track trackByTimerId($index, timer)) {
          <div class="p-3 rounded-lg border border-surface-200 dark:border-surface-700" [class]="getTimerClass(timer)">
            <!-- Timer Header -->
            <div class="flex items-start justify-between mb-2">
              <div class="flex-1">
                <div class="font-medium">{{ timer.name }}</div>
                <div class="text-sm text-surface-600 dark:text-surface-400">Order #{{ getOrderNumber(timer.orderId) }}</div>
              </div>
              <i [class]="'pi ' + (getTypeIcon(timer.type) === 'local_fire_department' ? 'pi-fire' : getTypeIcon(timer.type) === 'cut' ? 'pi-scissors' : getTypeIcon(timer.type) === 'pause' ? 'pi-pause' : getTypeIcon(timer.type) === 'ac_unit' ? 'pi-snowflake' : getTypeIcon(timer.type) === 'room_service' ? 'pi-box' : 'pi-clock')" [pTooltip]="getTypeTooltip(timer.type)"></i>
            </div>

            <!-- Timer Display -->
            <div class="mb-3">
              <div class="text-3xl font-bold text-center mb-2" [class]="getTimeClass(timer)">
                {{ formatTime(timer.remainingTime) }}
              </div>
              <p-progressbar
                [value]="getProgressPercentage(timer)"
                [showValue]="false"
                [color]="getProgressColor(timer) === 'warn' ? 'danger' : getProgressColor(timer) === 'accent' ? 'warning' : 'success'">
              </p-progressbar>
              <div class="text-center text-sm text-surface-600 dark:text-surface-400 mt-1">
                / {{ formatTime(timer.duration) }}
              </div>
            </div>

            <!-- Timer Controls -->
            <div class="flex items-center justify-between">
              <div class="flex gap-1">
                @if (timer.status === 'idle' || timer.status === 'paused') {
                  <p-button
                    icon="pi pi-play"
                    severity="success"
                    [text]="true"
                    [rounded]="true"
                    (click)="startTimer(timer.id)"
                    [disabled]="timer.status === 'running'"
                    pTooltip="Start Timer">
                  </p-button>
                }
                @if (timer.status === 'running') {
                  <p-button
                    icon="pi pi-pause"
                    severity="warn"
                    [text]="true"
                    [rounded]="true"
                    (click)="pauseTimer(timer.id)"
                    [disabled]="timer.status !== 'running'"
                    pTooltip="Pause Timer">
                  </p-button>
                }
                @if (timer.status === 'running' || timer.status === 'paused') {
                  <p-button
                    icon="pi pi-stop"
                    severity="danger"
                    [text]="true"
                    [rounded]="true"
                    (click)="stopTimer(timer.id)"
                    [disabled]="timer.status === 'completed'"
                    pTooltip="Stop Timer">
                  </p-button>
                }
                @if (timer.status === 'expired' || timer.status === 'completed') {
                  <p-button
                    icon="pi pi-refresh"
                    severity="secondary"
                    [text]="true"
                    [rounded]="true"
                    (click)="resetTimer(timer.id)"
                    pTooltip="Reset Timer">
                  </p-button>
                }
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  [text]="true"
                  [rounded]="true"
                  (click)="deleteTimer(timer.id)"
                  pTooltip="Delete Timer">
                </p-button>
              </div>

              <!-- Timer Status -->
              <div class="flex items-center gap-2 text-sm">
                <i [class]="'pi ' + (getStatusIcon(timer.status) === 'schedule' ? 'pi-clock' : getStatusIcon(timer.status) === 'play_circle' ? 'pi-play-circle' : getStatusIcon(timer.status) === 'pause_circle' ? 'pi-pause-circle' : getStatusIcon(timer.status) === 'check_circle' ? 'pi-check-circle' : getStatusIcon(timer.status) === 'error' ? 'pi-exclamation-circle' : 'pi-times-circle')"></i>
                <span>{{ getStatusLabel(timer.status) }}</span>
              </div>
            </div>
          </div>
        }
      </div>
    } @else {
      <div class="text-center py-8">
        <i class="pi pi-clock text-6xl text-surface-300 dark:text-surface-700 mb-4"></i>
        <h3 class="text-lg font-medium mb-2">No Active Timers</h3>
        <p class="text-surface-600 dark:text-surface-400">Create timers from order cards to track cooking times</p>
      </div>
    }
  </ng-template>

  <!-- Panel Actions -->
  @if (activeTimers().length > 0) {
    <ng-template pTemplate="footer">
      <div class="flex justify-between gap-2">
        <p-button
          label="Pause All"
          icon="pi pi-pause"
          severity="secondary"
          (click)="pauseAllTimers()"
          [disabled]="runningTimers().length === 0">
        </p-button>
        <p-button
          label="Clear Expired"
          icon="pi pi-trash"
          severity="secondary"
          (click)="stopAllExpired()"
          [disabled]="expiredTimers().length === 0">
        </p-button>
        <p-button
          [label]="isMuted() ? 'Unmute' : 'Mute' + ' Sounds'"
          [icon]="'pi ' + (isMuted() ? 'pi-volume-off' : 'pi-volume-up')"
          severity="danger"
          (click)="muteAllSounds()">
        </p-button>
      </div>
    </ng-template>
  }
</p-card>
