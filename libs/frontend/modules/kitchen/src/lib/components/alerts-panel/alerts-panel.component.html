<div class="flex flex-col h-full surface-section" [class.p-0]="embedded">
  @if (!embedded) {
    <div class="flex items-center justify-between p-4 border-b">
      <h3 class="text-lg font-semibold flex items-center gap-2">
        <i class="pi pi-bell"></i>
        Kitchen Alerts
        @if (unreadAlerts().length > 0) {
          <span class="text-500">
            ({{ unreadAlerts().length }})
          </span>
        }
      </h3>
      <p-button
        icon="pi pi-times"
        [rounded]="true"
        [text]="true"
        severity="secondary"
        (onClick)="close.emit()">
      </p-button>
    </div>
  }

  <div class="flex-1 overflow-y-auto" [class.p-4]="!embedded">
    <!-- Alert Summary -->
    @if (alerts().length > 0) {
      <div class="flex gap-3 mb-4">
        @if (criticalCount() > 0) {
          <div class="flex items-center gap-2 p-2 bg-red-50 border border-red-200 rounded-md">
            <i class="pi pi-times-circle text-red-500"></i>
            <span class="text-sm font-semibold">{{ criticalCount() }} Critical</span>
          </div>
        }
        @if (warningCount() > 0) {
          <div class="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-md">
            <i class="pi pi-exclamation-triangle text-orange-500"></i>
            <span class="text-sm font-semibold">{{ warningCount() }} Warning</span>
          </div>
        }
        @if (infoCount() > 0) {
          <div class="flex items-center gap-2 p-2 surface-100 border rounded-md">
            <i class="pi pi-info-circle text-primary-500"></i>
            <span class="text-sm font-semibold">{{ infoCount() }} Info</span>
          </div>
        }
      </div>
    }

    @if (alerts().length > 0) {
      <p-divider></p-divider>
    }

    <!-- Alert List -->
    @if (alerts().length > 0) {
      <div class="flex flex-col gap-3">
        @for (alert of sortedAlerts(); track trackByAlertId($index, alert)) {
          <div
            class="p-3 border rounded-md"
            [class]="getAlertClass(alert)">
            <div class="flex items-start justify-between mb-2">
              <div class="flex items-start gap-2">
                <i [class]="'pi pi-' + getAlertIcon(alert) + ' severity-' + alert.severity"></i>
                <div class="flex-1">
                  <div class="font-semibold">{{ getAlertTitle(alert) }}</div>
                  @if (alert.product) {
                    <div class="text-sm text-500">
                      {{ alert.product.name }}
                    </div>
                  }
                </div>
              </div>
              <div class="flex flex-col items-end gap-1">
                <p-chip
                  [label]="alert.severity | titlecase"
                  [styleClass]="'severity-' + alert.severity + ' text-xs'">
                </p-chip>
                <div class="text-xs text-500">
                  {{ getTimeAgo(alert.createdAt) }}
                </div>
              </div>
            </div>
            <div class="text-sm mb-2">
              {{ alert.message }}
            </div>
            @if (!alert.resolved) {
              <div class="flex gap-2">
                <p-button
                  label="Resolve"
                  icon="pi pi-check"
                  size="small"
                  (onClick)="resolveAlert(alert.id)">
                </p-button>
                <p-button
                  label="Details"
                  icon="pi pi-eye"
                  size="small"
                  [outlined]="true"
                  severity="secondary"
                  (onClick)="viewDetails(alert)">
                </p-button>
                <p-button
                  icon="pi pi-clock"
                  size="small"
                  [rounded]="true"
                  [outlined]="true"
                  severity="secondary"
                  pTooltip="Snooze for 30 minutes"
                  (onClick)="snoozeAlert(alert.id)">
                </p-button>
              </div>
            }
            @if (alert.resolved) {
              <div class="flex items-center gap-2 text-sm text-green-600">
                <i class="pi pi-check-circle"></i>
                <span>Resolved {{ getTimeAgo(alert.resolvedAt!) }}</span>
                @if (alert.resolvedBy) {
                  <span> by {{ alert.resolvedBy }}</span>
                }
              </div>
            }
          </div>
        }
      </div>
    } @else {
      <div class="flex flex-col items-center justify-center py-8 text-center">
        <i class="pi pi-bell-slash text-4xl text-500 mb-3"></i>
        <h4 class="text-lg font-semibold mb-1">No Active Alerts</h4>
        <p class="text-500">Kitchen operations are running smoothly</p>
      </div>
    }
  </div>

  <!-- Panel Actions -->
  @if (!embedded && alerts().length > 0) {
    <div class="flex gap-2 p-4 border-t">
      <p-button
        label="Mark All Read"
        icon="pi pi-check"
        [outlined]="true"
        severity="secondary"
        [disabled]="unreadAlerts().length === 0"
        (onClick)="markAllRead()">
      </p-button>
      <p-button
        label="Clear Resolved"
        icon="pi pi-trash"
        [outlined]="true"
        severity="secondary"
        [disabled]="resolvedAlerts().length === 0"
        (onClick)="clearResolved()">
      </p-button>
      <p-button
        label="Refresh"
        icon="pi pi-refresh"
        [outlined]="true"
        severity="secondary"
        (onClick)="refreshAlerts()">
      </p-button>
    </div>
  }
</div>
